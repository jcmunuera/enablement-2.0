# Skill Index
#
# Version: 3.0
# Date: 2025-01-15
# Model: v2.0
#
# Purpose: Pre-computed index for O(1) skill discovery
#
# ═══════════════════════════════════════════════════════════════════════════════
# CHANGES IN v3.0 (Model v2.0)
# ═══════════════════════════════════════════════════════════════════════════════
#
# - Skills have `type`: generation or transformation
# - Generation skills have `required_capabilities` (NOT modules)
# - Transformation skills have `target_capability`
# - NO `extends` - skills are self-contained
# - New transformation skills: skill-040, skill-041, skill-042
# - Deprecated skill-001 (replaced by skill-040)
#
# ═══════════════════════════════════════════════════════════════════════════════

---

# =============================================================================
# LAYERS
# =============================================================================

layers:
  soe:
    name: "System of Engagement"
    description: "UI, digital channels, user experience"
    technologies: [angular, react, vue, microfrontend]
    signals:
      keywords: [frontend, angular, react, vue, component, page, UI]
    skills: []

  soi:
    name: "System of Integration"
    description: "Microservices, APIs, orchestration"
    technologies: [java-spring, java-quarkus, nodejs-express]
    signals:
      keywords: [microservicio, microservice, API, REST, service, spring, backend]
    skills:
      # Generation Skills
      - code/soi/skill-020-microservice-java-spring
      - code/soi/skill-021-api-rest-java-spring
      # Transformation Skills
      - code/soi/skill-040-add-resilience-java-spring
      - code/soi/skill-041-add-api-exposure-java-spring
      - code/soi/skill-042-add-persistence-java-spring

  sor:
    name: "System of Record"
    description: "Core systems, mainframe"
    technologies: [cobol, cics, db2, jcl]
    signals:
      keywords: [mainframe, COBOL, CICS, DB2, batch, host]
    skills: []

# =============================================================================
# DOMAINS
# =============================================================================

domains:
  code:
    description: "Source code generation and transformation"
    layers: [soe, soi, sor]
    skills_by_layer:
      soe: []
      soi:
        - code/soi/skill-020-microservice-java-spring
        - code/soi/skill-021-api-rest-java-spring
        - code/soi/skill-040-add-resilience-java-spring
        - code/soi/skill-041-add-api-exposure-java-spring
        - code/soi/skill-042-add-persistence-java-spring
      sor: []

  design:
    description: "Architecture design and documentation"
    skills: []

  qa:
    description: "Quality analysis and validation"
    skills: []

  governance:
    description: "Compliance and policy verification"
    skills: []

# =============================================================================
# EXECUTION FLOWS
# =============================================================================

flows:
  code:
    GENERATE:
      description: "Create complete artifacts from scratch"
      flow_document: "runtime/flows/code/GENERATE.md"
      skills:
        - code/soi/skill-020-microservice-java-spring
        - code/soi/skill-021-api-rest-java-spring
    ADD:
      description: "Add capability to existing code (transformation)"
      flow_document: "runtime/flows/code/ADD.md"
      skills:
        - code/soi/skill-040-add-resilience-java-spring
        - code/soi/skill-041-add-api-exposure-java-spring
        - code/soi/skill-042-add-persistence-java-spring
    REFACTOR:
      description: "Transform existing code structure"
      flow_document: "runtime/flows/code/REFACTOR.md"
      skills: []
    MIGRATE:
      description: "Migrate between technologies or versions"
      flow_document: "runtime/flows/code/MIGRATE.md"
      skills: []
    REMOVE:
      description: "Remove capabilities from existing code"
      flow_document: "runtime/flows/code/REMOVE.md"
      skills: []

# =============================================================================
# SKILL DEFINITIONS (v3.0 - Model v2.0)
# =============================================================================
# 
# KEY CHANGES:
# - `type`: generation | transformation
# - `required_capabilities`: for generation skills (resolved via capability-index.yaml)
# - `target_capability`: for transformation skills
# - NO `extends` - each skill is self-contained
# - NO `modules` - resolved via capabilities
#

skills:

  # ═══════════════════════════════════════════════════════════════════════════
  # GENERATION SKILLS
  # ═══════════════════════════════════════════════════════════════════════════
  
  skill-020-microservice-java-spring:
    path: code/soi/skill-020-microservice-java-spring
    type: generation
    domain: code
    layer: soi
    stack: java-spring
    description: "Internal microservice with hexagonal architecture"
    
    # Capabilities this skill REQUIRES (resolved to modules via capability-index.yaml)
    required_capabilities:
      - architecture.hexagonal-base
    
    # Additional capabilities inferred from prompt (NOT declared here)
    
    keywords:
      - microservicio
      - microservice
      - internal service
      - servicio interno
      - DDD
      - hexagonal

  skill-021-api-rest-java-spring:
    path: code/soi/skill-021-api-rest-java-spring
    type: generation
    domain: code
    layer: soi
    stack: java-spring
    description: "Fusion REST API with HATEOAS"
    
    required_capabilities:
      - architecture.hexagonal-base
      - api-exposure.rest-hateoas
    
    keywords:
      - REST API
      - Domain API
      - Fusion API
      - HATEOAS
      - API REST
      - OpenAPI

  # ═══════════════════════════════════════════════════════════════════════════
  # TRANSFORMATION SKILLS
  # ═══════════════════════════════════════════════════════════════════════════

  skill-040-add-resilience-java-spring:
    path: code/soi/skill-040-add-resilience-java-spring
    type: transformation
    domain: code
    layer: soi
    stack: java-spring
    description: "Add resilience patterns to existing code"
    
    # The capability this skill ADDS to existing code
    target_capability: resilience
    
    # What existing architecture this skill can work with
    compatible_with:
      - architecture.hexagonal-base
    
    keywords:
      - add resilience
      - añadir resiliencia
      - circuit breaker
      - retry
      - timeout
      - fault tolerance
      - tolerancia a fallos

  skill-041-add-api-exposure-java-spring:
    path: code/soi/skill-041-add-api-exposure-java-spring
    type: transformation
    domain: code
    layer: soi
    stack: java-spring
    description: "Add API exposure to existing microservice"
    
    target_capability: api-exposure
    
    compatible_with:
      - architecture.hexagonal-base
    
    keywords:
      - add API
      - expose API
      - promote to API
      - promocionar a API
      - añadir REST
      - HATEOAS

  skill-042-add-persistence-java-spring:
    path: code/soi/skill-042-add-persistence-java-spring
    type: transformation
    domain: code
    layer: soi
    stack: java-spring
    description: "Add persistence to existing microservice"
    
    target_capability: persistence
    
    compatible_with:
      - architecture.hexagonal-base
    
    keywords:
      - add persistence
      - añadir persistencia
      - add database
      - add JPA
      - add System API
      - backend integration

  # ═══════════════════════════════════════════════════════════════════════════
  # DEPRECATED SKILLS
  # ═══════════════════════════════════════════════════════════════════════════

  skill-001-circuit-breaker-java-resilience4j:
    path: code/soi/skill-001-circuit-breaker-java-resilience4j
    type: transformation
    status: deprecated
    deprecated_by: skill-040-add-resilience-java-spring
    deprecation_reason: "Replaced by capability-level transformation skill"
    # Keeping for backward compatibility during migration

# =============================================================================
# DISCOVERY ALGORITHM (v3.0)
# =============================================================================
#
# 1. INTENT DETECTION:
#    - "generate", "create", "build" → look for GENERATION skills
#    - "add", "include", "enable" → look for TRANSFORMATION skills
#    - If unclear, default to GENERATION
#
# 2. DOMAIN/LAYER:
#    - Match keywords against layers.*.signals
#
# 3. SKILL FILTERING:
#    - For GENERATION: filter by required capabilities match
#    - For TRANSFORMATION: filter by target capability match
#
# 4. CAPABILITY EXTRACTION:
#    - From prompt, extract capability keywords
#    - Validate against capability-index.yaml
#
# 5. MODULE RESOLUTION:
#    - Skill.required_capabilities → capability-index.yaml → modules
#    - For transformation: target_capability → features from prompt → modules
#
# See: runtime/discovery/discovery-guidance.md for detailed algorithm

# =============================================================================
# INPUT VALIDATION
# =============================================================================

input_validation:
  
  # Generation skills
  skill-020-microservice-java-spring:
    required_fields:
      - serviceName
      - basePackage
    validation_rules:
      - field: serviceName
        pattern: "^[a-z][a-z0-9-]*$"
        error: "Service name must be kebab-case"

  skill-021-api-rest-java-spring:
    required_fields:
      - serviceName
      - basePackage
      - apiName
    validation_rules:
      - field: serviceName
        pattern: "^[a-z][a-z0-9-]*$"
        error: "Service name must be kebab-case"

  # Transformation skills
  skill-040-add-resilience-java-spring:
    required_fields:
      - targetProject
    optional_fields:
      - features  # Specific features (circuit-breaker, retry, timeout)
    validation_rules:
      - field: targetProject
        check: "must exist and be hexagonal architecture"
        error: "Target project must exist and use hexagonal architecture"

  skill-041-add-api-exposure-java-spring:
    required_fields:
      - targetProject
    optional_fields:
      - apiType  # rest-hateoas, grpc, etc.
    validation_rules:
      - field: targetProject
        check: "must exist and be hexagonal architecture"

  skill-042-add-persistence-java-spring:
    required_fields:
      - targetProject
      - persistenceType  # jpa or systemapi
    validation_rules:
      - field: persistenceType
        enum: [jpa, systemapi]
        error: "Must be 'jpa' or 'systemapi'"
