# Authoring Guide: Execution Flows

**Version:** 1.4  
**Date:** 2025-12-23

---

## Overview

Execution Flows define HOW skills of a specific type are executed within a domain. They are located in `runtime/flows/{domain}/{TYPE}.md`.

---

## When to Create a Flow

Create a new execution flow when:

- A new skill type is introduced to a domain
- The execution pattern for a skill type needs formal documentation
- A domain is being activated (moving from "Planned" to "Active")

---

## Location

```
runtime/flows/{domain}/{SKILL_TYPE}.md
```

Examples:
- `runtime/flows/code/GENERATE.md`
- `runtime/flows/code/ADD.md`
- `runtime/flows/design/ARCHITECTURE.md`

---

## Required Structure

Every execution flow document MUST include:

```markdown
# Skill Type: {DOMAIN}/{TYPE}

**Version:** X.Y  
**Date:** YYYY-MM-DD  
**Domain:** {DOMAIN}

---

## Purpose

[What this skill type does and when it's used]

---

## Execution Philosophy

[Key principles for this type - e.g., holistic vs atomic]

---

## Characteristics

| Aspect | Description |
|--------|-------------|
| Input | [What the skill receives] |
| Output | [What the skill produces] |
| Modules | [How modules are used] |
| Complexity | [Low/Medium/High] |

---

## Execution Flow

[Detailed step-by-step flow, preferably with ASCII diagram]

---

## Required Steps (v1.1)

Every execution flow that uses modules MUST include these steps:

### Variant Resolution Step

If the flow uses modules, it MUST include a **Variant Resolution** step after module loading:

```
STEP N: RESOLVE VARIANTS
───────────────────────────────────────────────────────────────────────────
Action: Select implementation variant for each module that has variants
Input:  List of modules + Request features
Output: Selected variant per module (default or alternative)

For each module with variants.enabled = true:

1. CHECK INPUT for explicit variant selection
2. EVALUATE recommendation conditions (if selection_mode = auto-suggest)
3. IF alternative recommended → ASK USER for confirmation
4. OTHERWISE → Use default variant
5. RECORD selection in manifest
───────────────────────────────────────────────────────────────────────────
```

### Determinism Rules Reference

For CODE domain flows, add reference to determinism rules:

```
During code generation, the agent MUST follow:
- model/standards/DETERMINISM-RULES.md (global patterns)
- Each module's ## Determinism section (module-specific patterns)
```

---

## Module Resolution Table

[If applicable - how features map to modules]

---

## Output Structure

Flows MUST define two output structures with clear separation of responsibilities:

### 1. Flow Output Structure (v1.4)

> ⚠️ **THIS IS THE OUTPUT OF THE FLOW, NOT OF THE SKILL**
>
> The Flow defines this structure. The Skill defines what goes inside `output/`.
> The user provides only input files; the agent MUST create this complete structure.

**MANDATORY**: This section should appear EARLY in the flow document (after Characteristics).

```markdown
## Flow Output Structure

Every {FLOW} execution produces this structure:

{flow-execution}/
├── input/                          # All inputs (copied + generated)
│   ├── prompt.md                   # Original user prompt
│   ├── generation-request.json     # Structured request (generated by agent)
│   └── {referenced-files}          # API specs, mappings, etc.
│
├── output/                         # Generated artifact (Skill-specific)
│   └── {artifact}/                 # Structure defined by Skill
│
├── trace/                          # Execution traceability
│   └── generation-trace.md         # Discovery & generation decisions
│
└── validation/                     # Reproducibility scripts
    ├── tier-1-universal.sh
    ├── tier-2-technology.sh
    ├── tier-3-skill.sh
    └── {artifact-specific}.sh      # compile.sh, test.sh, package.sh
```

**Responsibility separation:**

| Component | Defined By | Content |
|-----------|------------|---------|
| `input/`, `trace/`, `validation/` | **Flow** | Standard for all executions of this flow |
| `output/{artifact}/` | **Skill** | Specific to each skill/technology |

**Traceability separation:**

| File | Scope | Purpose |
|------|-------|---------|
| `trace/generation-trace.md` | Flow execution | Why decisions were made |
| `output/{artifact}/.enablement/manifest.json` | Artifact | What was used to generate |

### 2. Artifact Structure

The structure of the generated artifact itself. This is **Skill-specific** and goes inside `output/`.

```markdown
## Artifact Structure

The generated artifact follows this structure inside `output/`:

output/{serviceName}/
├── .enablement/
│   └── manifest.json       # Artifact traceability (REQUIRED)
├── src/
│   ├── main/
│   └── test/
├── pom.xml
└── README.md
```

> The Artifact Structure is defined by the **Skill**, not the Flow.
> Each Skill specifies its own artifact structure based on technology/domain.

---

## Validation Requirements

[What validations apply]

---

## Error Handling

[How to handle common errors]

---

## Example Skills

[List of skills that use this flow]
```

---

## Post-Creation Checklist

> ⚠️ **CRITICAL:** After creating a new execution flow, you MUST complete these steps.

### 1. Update CONSUMER-PROMPT.md

Location: `model/CONSUMER-PROMPT.md`

Update the **Domain-Specific Execution** table:

```markdown
| Domain | Execution Flows Location | Notes |
|--------|--------------------------|-------|
| CODE | `runtime/flows/code/` | GENERATE (holistic), ADD (atomic), ... |
| DESIGN | `runtime/flows/design/` | (Planned) → UPDATE THIS |
```

**Change required:**
- If domain was "(Planned)", replace with actual flow names
- If adding to existing domain, add the new flow name to the list

### 2. Update Domain DOMAIN.md

Location: `model/domains/{domain}/DOMAIN.md`

Ensure the **Skill Types** section lists the new type and references the flow:

```markdown
## Skill Types

| Type | Purpose | Flow |
|------|---------|------|
| GENERATE | Create new projects | `runtime/flows/code/GENERATE.md` |
| NEW_TYPE | [Purpose] | `runtime/flows/{domain}/NEW_TYPE.md` |
```

### 3. Verify Discovery Path

Ensure the agent can discover and execute:

1. ✅ DOMAIN.md has discovery guidance for when this skill type applies
2. ✅ At least one skill exists that uses this flow (or is planned)
3. ✅ CONSUMER-PROMPT.md references the flow location

---

## Validation Checklist

Before considering the flow complete:

- [ ] Document follows required structure
- [ ] Execution philosophy is clearly stated
- [ ] Step-by-step flow is documented
- [ ] **Variant Resolution step included** (if flow uses modules)
- [ ] **Determinism rules referenced** (for CODE domain)
- [ ] **Flow Output Structure defined EARLY** (before execution phases)
- [ ] **Artifact Structure defined** (Skill-specific, inside output/)
- [ ] Error handling is defined
- [ ] **CONSUMER-PROMPT.md updated** ← Don't forget!
- [ ] **DOMAIN.md updated** ← Don't forget!
- [ ] At least one example skill listed

---

## Examples

### Good: CODE/GENERATE

See `runtime/flows/code/GENERATE.md` for a complete example including:
- Clear holistic execution philosophy
- Detailed ASCII flow diagram
- Module resolution table
- Why holistic matters (with code examples)
- Complete traceability requirements

### Good: CODE/ADD

See `runtime/flows/code/ADD.md` for a complete example of atomic execution flow.

---

## Common Mistakes

| Mistake | Impact | Prevention |
|---------|--------|------------|
| Not updating CONSUMER-PROMPT.md | Agent doesn't know flow exists | Use checklist above |
| Missing execution philosophy | Unclear how to execute | Always start with philosophy |
| No ASCII flow diagram | Hard to understand sequence | Include visual representation |
| No module resolution | Agent can't map features to modules | Include resolution table |

---

## Related Documents

- `model/CONSUMER-PROMPT.md` - Must be updated when adding flows
- `model/domains/{domain}/DOMAIN.md` - Must list skill types
- `authoring/SKILL.md` - Skills reference flows
- `authoring/VALIDATOR.md` - Flows define validation requirements

---

**END OF DOCUMENT**
